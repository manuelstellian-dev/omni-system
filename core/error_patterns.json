{
  "patterns": [
    {
      "error_signature": "ModuleNotFoundError: No module named 'pytest'",
      "category": "missing_dependency",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Add pytest to requirements.txt",
        "file_path": "requirements.txt",
        "add_line": "pytest>=7.4.0\npytest-asyncio>=0.21.0",
        "command": "pip install pytest pytest-asyncio"
      },
      "success_rate": 0.98,
      "confidence": "high"
    },
    {
      "error_signature": "ModuleNotFoundError: No module named 'httpx'",
      "category": "missing_dependency",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Add httpx to requirements.txt for testing FastAPI",
        "file_path": "requirements.txt",
        "add_line": "httpx>=0.25.0",
        "command": "pip install httpx"
      },
      "success_rate": 0.97,
      "confidence": "high"
    },
    {
      "error_signature": "ImportError: cannot import name",
      "category": "import_error",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Check import path and fix typos in module names",
        "typical_causes": [
          "Typo in import statement",
          "Wrong module path",
          "Circular import",
          "Missing __init__.py"
        ]
      },
      "success_rate": 0.85,
      "confidence": "medium"
    },
    {
      "error_signature": "sqlite3.OperationalError: no such table",
      "category": "database_setup",
      "fix_strategy": "test_config",
      "solution": {
        "description": "Initialize database tables in test fixtures",
        "file_path": "tests/conftest.py",
        "fix_approach": "Add database.Base.metadata.create_all() in fixture setup"
      },
      "success_rate": 0.92,
      "confidence": "high"
    },
    {
      "error_signature": "fixture 'client' not found",
      "category": "test_fixture",
      "fix_strategy": "test_config",
      "solution": {
        "description": "Add missing test fixture in conftest.py",
        "file_path": "tests/conftest.py",
        "fix_approach": "Define @pytest.fixture for the missing fixture"
      },
      "success_rate": 0.94,
      "confidence": "high"
    },
    {
      "error_signature": "AssertionError: assert 200 == 404",
      "category": "logic_error",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "API endpoint returning wrong status code",
        "typical_causes": [
          "Incorrect route definition",
          "Missing database record",
          "Wrong HTTP method",
          "Authentication failure"
        ]
      },
      "success_rate": 0.7,
      "confidence": "medium"
    },
    {
      "error_signature": "TypeError: argument of type 'NoneType' is not iterable",
      "category": "null_check",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Missing null/None check before iteration",
        "fix_approach": "Add: if variable is not None: before using it"
      },
      "success_rate": 0.88,
      "confidence": "high"
    },
    {
      "error_signature": "AttributeError: 'NoneType' object has no attribute",
      "category": "null_check",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Attempting to access attribute on None object",
        "fix_approach": "Add null check or use Optional[] type hint"
      },
      "success_rate": 0.86,
      "confidence": "high"
    },
    {
      "error_signature": "IndentationError:",
      "category": "syntax_error",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Fix Python indentation (use 4 spaces)",
        "fix_approach": "Ensure consistent indentation throughout file"
      },
      "success_rate": 0.99,
      "confidence": "high"
    },
    {
      "error_signature": "SyntaxError: invalid syntax",
      "category": "syntax_error",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Python syntax error - missing colon, parenthesis, etc.",
        "typical_causes": [
          "Missing colon after def/if/for/while",
          "Unclosed parenthesis or bracket",
          "Invalid Python keyword usage"
        ]
      },
      "success_rate": 0.95,
      "confidence": "high"
    },
    {
      "error_signature": "NameError: name '.*' is not defined",
      "category": "undefined_variable",
      "fix_strategy": "quick_fixes",
      "solution": {
        "description": "Variable used before definition",
        "fix_approach": "Define variable or add import statement"
      },
      "success_rate": 0.91,
      "confidence": "high"
    },
    {
      "error_signature": "ValueError: invalid literal for int()",
      "category": "type_conversion",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Invalid string to integer conversion",
        "fix_approach": "Add validation or try/except block"
      },
      "success_rate": 0.84,
      "confidence": "medium"
    },
    {
      "error_signature": "KeyError:",
      "category": "missing_key",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Dictionary key doesn't exist",
        "fix_approach": "Use dict.get() with default value or check key existence"
      },
      "success_rate": 0.89,
      "confidence": "high"
    },
    {
      "error_signature": "asyncio.TimeoutError",
      "category": "async_timeout",
      "fix_strategy": "simplify",
      "solution": {
        "description": "Async operation timed out",
        "fix_approach": "Increase timeout or optimize async operation"
      },
      "success_rate": 0.72,
      "confidence": "medium"
    },
    {
      "error_signature": "FileNotFoundError:",
      "category": "missing_file",
      "fix_strategy": "regenerate_files",
      "solution": {
        "description": "Required file doesn't exist",
        "fix_approach": "Generate missing file or fix file path"
      },
      "success_rate": 0.93,
      "confidence": "high"
    },
    {
      "error_signature": "RuntimeError: Event loop is closed",
      "category": "asyncio_lifecycle",
      "fix_strategy": "test_config",
      "solution": {
        "description": "Async event loop closed prematurely",
        "fix_approach": "Use asyncio.run() or proper async test fixtures"
      },
      "success_rate": 0.68,
      "confidence": "low"
    },
    {
      "error_signature": "FAILED tests/.*::test_",
      "category": "test_failure",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Test assertion failed",
        "typical_causes": [
          "Incorrect expected value",
          "Logic bug in implementation",
          "Test setup issue",
          "Race condition in async test"
        ]
      },
      "success_rate": 0.65,
      "confidence": "medium"
    },
    {
      "error_signature": "pydantic.ValidationError:",
      "category": "validation_error",
      "fix_strategy": "logic_fixes",
      "solution": {
        "description": "Pydantic model validation failed",
        "fix_approach": "Fix data types to match model schema"
      },
      "success_rate": 0.87,
      "confidence": "high"
    },
    {
      "error_signature": "Next.js build failure with 'Cannot find namespace JSX' and 'multiple lockfiles' warning, often due to 'latest' dependencies, monorepo context, and incorrect PostCSS configuration.",
      "category": "meta_learned",
      "fix_strategy": "meta_cognitive",
      "solution": {
        "summary": "The fix involved pinning all critical dependencies (Next.js, React, types) to stable, compatible versions, explicitly configuring the `turbopack.root` in `next.config.js` to resolve workspace ambiguity, creating a correct `postcss.config.js` for Tailwind, and simplifying the return type annotation in `layout.tsx`.",
        "prevention": "Avoid using 'latest' for critical dependencies; always pin to specific versions. Explicitly configure Next.js workspace root in monorepos. Ensure `postcss.config.js` is correctly set up for styling. Regularly review and update dependencies in a controlled manner, performing clean installs (`rm -rf node_modules package-lock.json && npm install`) after significant changes.",
        "tech_stack": [
          "Next.js",
          "React",
          "TypeScript",
          "Tailwind CSS"
        ],
        "learned_at": "2025-11-21"
      },
      "success_rate": 1.0,
      "confidence": "high",
      "times_applied": 1
    },
    {
      "error_signature": "Dependency version drift (using 'latest' tags) leading to cascading type and runtime errors across core libraries (Next.js, NextAuth.js, React, Stripe) and incomplete boilerplate setup.",
      "category": "meta_learned",
      "fix_strategy": "meta_cognitive",
      "solution": {
        "summary": "Stabilized the project by pinning all critical dependencies to known-good, compatible versions (Next.js 14.x, React 18.x, NextAuth.js 4.x, Prisma 5.x, Stripe 15.x). Addressed specific API changes for Next.js App Router (async `headers()`) and Stripe SDK (API version, `current_period_end` type). Implemented correct NextAuth.js v4 integration patterns for App Router server components (`getServerSession`) and client components (`SessionProvider`). Created missing boilerplate files (`src/lib/stripe/utils.ts`, `src/components/providers/auth-provider.tsx`, `src/auth.ts`) and configured the testing environment (`jest.config.ts`, `jest.setup.ts`, `@testing-library/jest-dom`).",
        "prevention": "1. **Avoid `\"latest\"` for production dependencies:** Always pin major and minor versions (e.g., `^14.2.3` or `14.2.3`) to prevent unexpected breaking changes. 2. **Understand Semantic Versioning:** Be aware that major version bumps (e.g., `next-auth` v4 to v5) almost always introduce breaking changes. Review release notes before upgrading. 3. **Staged Upgrades:** Upgrade dependencies incrementally, testing each major component (e.g., Next.js, then NextAuth.js, then Prisma) to isolate issues. 4. **Comprehensive Boilerplate Setup:** Ensure all necessary files and configurations (like `src/auth.ts`, `src/components/providers/auth-provider.tsx`, `jest.setup.ts`, utility files) are present and correctly structured from the start. 5. **Leverage TypeScript's Strict Mode:** Maintain `strict: true` in `tsconfig.json` to catch type mismatches early, especially when dealing with external APIs like Stripe.",
        "tech_stack": [
          "Next.js 15 (App Router)",
          "Prisma ORM",
          "PostgreSQL",
          "Stripe",
          "Resend",
          "Zod",
          "TypeScript",
          "GitHub Actions",
          "Docker",
          "OpenTelemetry",
          "Grafana",
          "Railway",
          "NextAuth.js",
          "Tailwind CSS",
          "Jest"
        ],
        "learned_at": "2025-11-21"
      },
      "success_rate": 1.0,
      "confidence": "high",
      "times_applied": 1
    },
    {
      "error_signature": "DependencyMismatch_NextAuthV5Beta_React19RC_PrismaSchema",
      "category": "meta_learned",
      "fix_strategy": "meta_cognitive",
      "solution": {
        "summary": "The core issue was a combination of highly experimental dependency versions (React 19 RC, Next.js 15, NextAuth v5 beta) causing API incompatibilities and type errors. The fix involved downgrading React to a stable 18.x version, updating the Prisma schema to include missing Stripe-related fields, and refactoring NextAuth usage to conform to its v5 beta API (e.g., `auth()` instead of `getServerSession`, new adapter/provider imports, and proper environment variable handling with type assertions).",
        "prevention": "To avoid similar issues in the future:\n1.  **Dependency Version Pinning & Stability:** Avoid using Release Candidate (RC) or beta versions of major frameworks (React, Next.js) in production or early development unless absolutely necessary and with a clear understanding of potential breaking changes. Prefer stable versions. Use exact version pinning for critical dependencies.\n2.  **NextAuth Version Management:** Be aware of major version changes in NextAuth (especially v4 to v5). These often involve significant API overhauls. Consult migration guides carefully.\n3.  **Prisma Schema & Client Sync:** Always update `schema.prisma` first when adding new data model fields, and then run `npx prisma generate` to ensure the Prisma client is in sync with the database schema.\n4.  **TypeScript Strictness:** Embrace `strict: true` from the start. Implement robust environment variable validation and explicit type definitions for all function parameters and return values to prevent `noImplicitAny` and `string | undefined` assignment errors.",
        "tech_stack": [
          "Next.js 15 (App Router)",
          "Prisma ORM",
          "PostgreSQL",
          "Stripe",
          "Resend",
          "Zod",
          "TypeScript",
          "GitHub Actions",
          "Docker",
          "OpenTelemetry",
          "Grafana",
          "Railway",
          "NextAuth.js",
          "Tailwind CSS",
          "Jest"
        ],
        "learned_at": "2025-11-21"
      },
      "success_rate": 1.0,
      "confidence": "high",
      "times_applied": 1
    },
    {
      "error_signature": "PrismaSchemaMismatch|DependencyInstability|TypeScriptConfig",
      "category": "meta_learned",
      "fix_strategy": "meta_cognitive",
      "solution": {
        "summary": "The core issue was a desynchronized Prisma schema and client, leading to numerous type errors. This was resolved by inferring and adding missing models/fields to `schema.prisma` and regenerating the Prisma client. Additionally, Next.js was downgraded for stability, and a TypeScript configuration issue for `jest.config.ts` was fixed. A specific API route parameter typing was also corrected.",
        "prevention": "1. Always run `npm run prisma:generate` after any changes to `schema.prisma`. 2. Prefer stable versions of core dependencies (Next.js, NextAuth) for boilerplate projects unless specific beta features are required and thoroughly tested. 3. Ensure `tsconfig.json` and project setup correctly handle all `.ts` files, especially configuration files, as modules or scripts as appropriate. 4. Implement strict type checking for all API route parameters and request data.",
        "tech_stack": [
          "Next.js 15 (App Router)",
          "Prisma ORM",
          "PostgreSQL",
          "Stripe",
          "Resend",
          "Zod",
          "TypeScript",
          "GitHub Actions",
          "Docker",
          "OpenTelemetry",
          "Grafana",
          "Railway",
          "NextAuth.js",
          "Tailwind CSS",
          "Jest"
        ],
        "learned_at": "2025-11-21"
      },
      "success_rate": 1.0,
      "confidence": "high",
      "times_applied": 1
    }
  ],
  "metadata": {
    "version": "1.0",
    "last_updated": "2025-11-20",
    "total_patterns": 18,
    "description": "OMNI RepairAgent error pattern knowledge base. This database helps RepairAgent make faster, smarter repair decisions by recognizing common error patterns and applying known fixes.",
    "learning_enabled": true,
    "notes": "Patterns are ordered by confidence and success rate. RepairAgent can extend this database as it learns from successful repairs."
  }
}